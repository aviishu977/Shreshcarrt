<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <title>გლობალური ჩატი</title>
</head>
<body>
  <h1>ჩატი</h1>

  <input type="text" id="username" placeholder="შეიყვანე შენი სახელი" />
  <input type="text" id="messageInput" placeholder="შეტყობინება..." />
  <button id="sendBtn">გაგზავნა</button>

  <div id="chatBox" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyChpCuDHZVEbWQ4Uw_NoVr5xyUvXtUtGZA",
      authDomain: "test-a79ec.firebaseapp.com",
      databaseURL: "https://test-a79ec-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "test-a79ec",
      storageBucket: "test-a79ec.firebasestorage.app",
      messagingSenderId: "966991665801",
      appId: "1:966991665801:web:5d6f25671bca9022b0c458"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const chatRef = ref(db, "messages/");

    const sendBtn = document.getElementById("sendBtn");
    const messageInput = document.getElementById("messageInput");
    const usernameInput = document.getElementById("username");
    const chatBox = document.getElementById("chatBox");

    sendBtn.addEventListener("click", () => {
      const message = messageInput.value.trim();
      const username = usernameInput.value.trim() || "უცნობი";

      if (message) {
        push(chatRef, {
          user: username,
          text: message,
          time: new Date().toLocaleTimeString()
        });
        messageInput.value = "";
      }
    });

    onValue(chatRef, (snapshot) => {
      chatBox.innerHTML = "";
      snapshot.forEach(child => {
        const msg = child.val();
        const div = document.createElement("div");
        div.innerHTML = `<strong>${msg.user}:</strong> ${msg.text} <small style="color:gray;">[${msg.time}]</small>`;
        chatBox.appendChild(div);
      });
    });
  </script>
</body>
</html>
