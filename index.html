<!DOCTYPE html><html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>საჯარო პოსტები</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');:root {
  --color-primary: #2563eb;
  --color-primary-dark: #1e40af;
  --color-background: #f5f7fa;
  --color-card-bg: #ffffff;
  --color-text-primary: #111827;
  --color-text-secondary: #6b7280;
  --color-border: #e5e7eb;
  --color-shadow-light: rgba(0, 0, 0, 0.05);
  --color-shadow-dark: rgba(0, 0, 0, 0.1);
  --radius-base: 18px;
  --spacing-base: 16px;
  --font-family: 'Inter', sans-serif;
}
@font-face {
  font-family: 'myffont';
  src: url('alk-sanet.ttf');
}
* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;font-family: 'myffont';
}

body {
  font-family: var(--font-family);
  background-color: var(--color-background);
  color: var(--color-text-primary);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

header {
  background-color: var(--color-primary);
  color: white;
  font-weight: 700;
  font-size: 1.5rem;
  padding: var(--spacing-base);
  text-align: center;
  box-shadow: 0 4px 12px var(--color-shadow-dark);
}

main {
  flex: 1;
  max-width: 480px;
  margin: var(--spacing-base) auto 2rem;
  width: 95%;
  display: flex;
  flex-direction: column;
  gap: 1.75rem;
  padding: 0 var(--spacing-base);
}

form {
  background: var(--color-card-bg);
  border-radius: var(--radius-base);
  padding: 1.75rem 1.5rem;
  box-shadow: 0 8px 16px var(--color-shadow-light), inset 0 0 0 1px var(--color-border);
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

textarea {
  resize: vertical;
  min-height: 110px;
  border: 1.5px solid var(--color-border);
  border-radius: 14px;
  padding: 1rem 1.25rem;
  font-size: 1.125rem;
  background: var(--color-background);
}

.camera-button {
  display: inline-block;
  background-color: var(--color-primary);
  color: white;
  padding: 0.9rem 1rem;
  font-weight: 700;
  font-size: 1.1rem;
  border-radius: 14px;
  cursor: pointer;
  transition: 0.3s ease;
  box-shadow: 0 8px 20px rgba(37, 99, 235, 0.5);
  user-select: none;
  text-align: center;
}

#imageInput {
  display: none;
}

button {
  background-color: var(--color-primary);
  border: none;
  border-radius: 14px;
  padding: 1rem 0;
  font-weight: 700;
  font-size: 1.2rem;
  color: white;
  cursor: pointer;
}

button:disabled {
  background-color: #93c5fd;
  cursor: not-allowed;
}

#previewImage {
  max-width: 100%;
  border-radius: 14px;
  object-fit: cover;
  max-height: 280px;
  aspect-ratio: 16 / 9;
  display: none;
}

#imageStatus, #errorMessage {
  font-size: 0.9rem;
  font-weight: 600;
  min-height: 1.2rem;
}

#imageStatus {
  color: var(--color-text-secondary);
}

#errorMessage {
  color: red;
  display: none;
}

.post-card {
  background: var(--color-card-bg);
  border-radius: var(--radius-base);
  padding: 1.5rem 1.75rem;
  box-shadow: 0 12px 24px var(--color-shadow-light);
  display: flex;
  flex-direction: column;
  gap: 1rem;
  cursor: pointer;
  margin-top: 20px;
}

.post-image {
  width: 100%;
  height: auto;
  border-radius: 14px;
  object-fit: contain;
  pointer-events: none;
}

.post-text {
  font-size: 1.125rem;
  white-space: pre-wrap;
  font-weight: 500;
}

.timestamp {
  font-size: 0.8rem;
  color: var(--color-text-secondary);
  align-self: flex-end;
}

  </style>
</head>
<body><header>ჩასელფე</header><main>
  <form id="postForm" autocomplete="off" novalidate>
    <label for="imageInput" class="camera-button">ფოტოს გადაღება</label>
    <textarea id="contentText" placeholder="დაწერე ტექსტი..."></textarea>
    <input type="file" id="imageInput" accept="image/*" capture="environment" />
    <img id="previewImage" alt="ფოტოს პრევიუ" />
    <p id="imageStatus"></p>
    <p id="errorMessage">ფოტოს დამატება სავალდებულოა!</p>
    <button type="submit">პოსტის გამოქვეყნება</button>
  </form>
  <section id="posts"></section>
</main><script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getDatabase, ref, push, query, orderByChild, onValue } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBO1nTM6QGumu25F7lnkCHuRjP1o7WF74s",
    authDomain: "tete-bb546.firebaseapp.com",
    databaseURL: "https://tete-bb546-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "tete-bb546",
    storageBucket: "tete-bb546.appspot.com",
    messagingSenderId: "985504524225",
    appId: "1:985504524225:web:a0a170ffa30b1e6f66f140"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const postsRef = ref(db, 'posts');

  const form = document.getElementById('postForm');
  const contentText = document.getElementById('contentText');
  const imageInput = document.getElementById('imageInput');
  const previewImage = document.getElementById('previewImage');
  const imageStatus = document.getElementById('imageStatus');
  const errorMessage = document.getElementById('errorMessage');
  const postsContainer = document.getElementById('posts');

  imageInput.addEventListener('change', () => {
    const file = imageInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        previewImage.src = reader.result;
        previewImage.style.display = 'block';
        imageStatus.textContent = '✅ ფოტო გამზადებულია პოსტისთვის';
        errorMessage.style.display = 'none';
      };
      reader.readAsDataURL(file);
    } else {
      previewImage.style.display = 'none';
      imageStatus.textContent = '';
    }
  });

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      if (!file) return resolve(null);
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject(new Error('ფაილის წაკითხვა ვერ მოხერხდა'));
      reader.readAsDataURL(file);
    });
  }

  function formatTimestamp(ts) {
    return new Date(ts).toLocaleString('ka-GE', { dateStyle: 'medium', timeStyle: 'short' });
  }

  function renderPost(post) {
    const card = document.createElement('article');
    card.className = 'post-card';

    const textEl = document.createElement('p');
    textEl.className = 'post-text';
    textEl.textContent = post.contentText;
    card.appendChild(textEl);

    if (post.imageBase64) {
      const img = document.createElement('img');
      img.className = 'post-image';
      img.src = post.imageBase64;
      card.appendChild(img);
    }

    const timeEl = document.createElement('time');
    timeEl.className = 'timestamp';
    timeEl.textContent = formatTimestamp(post.timestamp);
    card.appendChild(timeEl);

    return card;
  }

  const postsQuery = query(postsRef, orderByChild('timestamp'));
  onValue(postsQuery, (snapshot) => {
    const posts = [];
    snapshot.forEach(child => {
      const data = child.val();
      if (data && typeof data.timestamp === "number") {
        posts.push(data);
      }
    });
    posts.sort((a, b) => b.timestamp - a.timestamp);
    postsContainer.innerHTML = '';
    posts.forEach(post => postsContainer.appendChild(renderPost(post)));
  });

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const text = contentText.value.trim();
    const file = imageInput.files[0];

    if (!file) {
      errorMessage.style.display = 'block';
      return;
    }

    if (!text) return;

    let imageBase64;
    try {
      imageBase64 = await fileToBase64(file);
    } catch {
      alert('სურათის წაკითხვა ვერ მოხერხდა.');
      return;
    }

    const newPost = {
      contentText: text,
      imageBase64,
      timestamp: Date.now()
    };

    await push(postsRef, newPost);
    form.reset();
    previewImage.style.display = 'none';
    imageStatus.textContent = '';
    errorMessage.style.display = 'none';
  });
</script></body>
</html>
